# WEB 端是如何录屏的？

提到录屏，大家可能都回想这应该属于客户端的能力，不过我们知道随着 H5 的发展，越来越多原生开发才能做的事情，通过 WEB 也能够实现了。`录屏`也不例外。

W3C 在 2013 年就制定了相应的 web 标准，称为 [MediaRecorder API](https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder)（旧称 MediaStream Recording API）。具体 api 细节这里就不展开了，总结一下步骤就是先获取一个 MediaStream，然后调用 new MediaRecorder(mediaStrean) 生成 recorder 实例，最后录制视频。

这里值得注意的是如果获取 MediaStream？

如果整个 WEB 应用都是用 canvas 绘制的(比如游戏)，那么比较简单，直接使用 canvas 提供的 api: [captureStream](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/captureStream)

```javascript
// 基于 canvas 录屏
const chunks = [];
const stream = canvas.captureStream;
const recorder = new MediaRecorder(stream);
recorder.addEventListener("dataavailable", e => chunks.push(e.data));

// 开始录屏
recorder.start();

// 结束录屏
recorder.stop();

// blob
const blob = new Blob(chunks, {
  type: "video/webm"
});
```

如果不是 canvas，仅仅是普通的网页，那么需要先调用 navigator.mediaDevices
.getDisplayMedia 获取屏幕流

```javascript
const stream = await navigator.mediaDevices.getDisplayMedia();
```

不同的是，`getDisplayMedia` 获取的媒体流已经不限于浏览器，甚至是其他应用窗口
![1.png]()

《XREPLAY-云端录屏及回放解决方案》
一句话介绍下 XReplay 就是：可以将 HTML 页面上的任何行为一帧帧的记录下来，用于录播或直播，并且性能极高、体积极小

chrome 的接口 [chrome.desktopCapture](https://developer.chrome.com/extensions/desktopCapture)
